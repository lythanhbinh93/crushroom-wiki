<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω l·ªãch l√†m - Crush Room Wiki</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Mobile Menu Button & Backdrop -->
  <button class="mobile-menu-btn" id="mobile-menu-btn" style="display:none;">
    <div class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>
  <div class="mobile-menu-backdrop" id="mobile-menu-backdrop"></div>

  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üíé</span>
          <span class="logo-text">Crush Room</span>
        </div>
        <span class="wiki-badge">Wiki</span>
      </div>

      <nav class="sidebar-nav">
        <a href="../index.html" class="nav-item">
          <span class="nav-icon">üè†</span>
          <span>Trang ch·ªß</span>
        </a>

        <a href="schedule.html" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
        </a>

        <a href="schedule-admin.html" class="nav-item active" data-admin-only>
          <span class="nav-icon">üß©</span>
          <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
        </a>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üí¨</span>
            <span>Customer Service</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="cs/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="cs/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üì¢</span>
            <span>Marketing</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="marketing/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="marketing/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">‚ö°</span>
            <span>Laser</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="laser/guide.html" class="nav-subitem">H∆∞·ªõng d·∫´n kh·∫Øc Laser</a>
            <a href="laser/lightburn.html" class="nav-subitem">Th√¥ng s·ªë Lightburn</a>
          </div>
        </div>
      </nav>

      <div class="user-info"></div>

      <div class="sidebar-footer">
        <p>¬© 2025 Crush Room</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="breadcrumb">
        <a href="../index.html">Trang ch·ªß</a>
        <span>/</span>
        <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
      </div>

      <header class="page-header">
        <div class="page-header-content">
          <h1>üß© Qu·∫£n l√Ω l·ªãch l√†m</h1>
          <p class="header-subtitle">
            Xem ƒëƒÉng k√Ω ca linh ho·∫°t, ph√¢n ca theo gi·ªù v√† ch·ªët l·ªãch l√†m ch√≠nh th·ª©c cho team
          </p>
        </div>
      </header>

      <!-- B·∫£ng ca theo gi·ªù -->
      <section class="content-section schedule-card">
        <div class="section-header">
          <div class="section-title-group">
            <h2>üìä Qu·∫£n l√Ω ca l√†m vi·ªác</h2>
          </div>

          <!-- View Mode Toggle -->
          <div class="view-mode-toggle">
            <button id="toggle-overview-mode" class="view-toggle-btn">
              <span class="btn-icon">üìÖ</span>
              L·ªãch r√£nh
            </button>
            <button id="toggle-detail-mode" class="view-toggle-btn active">
              <span class="btn-icon">‚úÖ</span>
              L·ªãch ch·ªët
            </button>
          </div>
        </div>

        <!-- Filter controls -->
        <div class="filter-controls">
          <div class="form-group">
            <label for="week-start-admin" class="form-label">Tu·∫ßn b·∫Øt ƒë·∫ßu</label>
            <input type="date" id="week-start-admin" class="form-input" />
          </div>
          <div class="form-group">
            <label for="team-select-admin" class="form-label">Team</label>
            <select id="team-select-admin" class="form-select">
              <option value="cs">Customer Service (CS)</option>
              <option value="mo">Marketing (MO)</option>
            </select>
          </div>
          <div class="form-group">
            <button id="load-admin-btn" class="btn btn-primary">
              <span class="btn-icon">üì•</span>
              T·∫£i d·ªØ li·ªáu
            </button>
          </div>
        </div>
        <div id="admin-message" class="alert-message"></div>

        <!-- Status bar -->
        <div class="schedule-admin-status-bar">
          <div class="status-info">
            <span id="week-status-text" class="status-text"></span>
            <span id="save-week-message" class="save-message"></span>
          </div>

          <div class="status-actions">
            <button id="save-week-schedule-btn" class="btn btn-primary btn-sm">
              <span class="btn-icon">üíæ</span>
              L∆∞u l·ªãch
            </button>

            <button id="lock-week-btn" class="btn btn-secondary btn-sm">
              <!-- JS will update text -->
            </button>
          </div>
        </div>

        <div class="info-box">
          <span class="info-icon">üí°</span>
          <p>Nh·ªõ <strong>L∆∞u l·ªãch</strong> sau khi ph√¢n ca ‚Üí <strong>Ch·ªët l·ªãch</strong> ƒë·ªÉ c√¥ng b·ªë cho team</p>
        </div>

        <div class="mode-descriptions">
          <div class="mode-description">
            <span class="mode-bullet">‚Ä¢</span>
            <strong>Click v√†o t√™n</strong> ƒë·ªÉ ph√¢n ca, ho·∫∑c ch·ªçn nhi·ªÅu √¥ r·ªìi d√πng Quick Assignment
          </div>
        </div>

        <!-- Quick Assignment Panel -->
        <div class="quick-assignment-panel">
          <div class="qa-header">
            <span class="qa-icon">‚ö°</span>
            <strong class="qa-title">Ph√¢n ca nhanh</strong>
            <span style="font-size: 12px; color: #666; font-weight: normal; margin-left: 8px;">
              (Click v√†o c√°c √¥ trong b·∫£ng ƒë·ªÉ ch·ªçn)
            </span>
          </div>

          <div class="qa-controls">
            <select id="qa-employee-select" class="form-select qa-select">
              <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
            </select>

            <div class="qa-counter">
              <strong class="qa-label">ƒê√£ ch·ªçn:</strong>
              <span id="qa-count-value" class="qa-badge">0</span>
              <span style="font-size: 11px; color: #999; margin-left: 4px;">ca</span>
            </div>

            <button id="qa-assign-btn" class="btn btn-primary btn-sm" disabled>
              <span class="btn-icon">‚úÖ</span>
              Ph√¢n ca
            </button>

            <button id="qa-clear-selection-btn" class="btn btn-secondary btn-sm">
              <span class="btn-icon">‚úñ</span>
              B·ªè ch·ªçn
            </button>
          </div>
        </div>

        <!-- Schedule Table -->
        <div class="table-wrapper">
          <table class="data-table schedule-table">
            <thead>
              <tr>
                <th class="th-time">Gi·ªù / Ng√†y</th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 2</div>
                  <div id="schedule-main-date-0" class="day-date"></div>
                </th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 3</div>
                  <div id="schedule-main-date-1" class="day-date"></div>
                </th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 4</div>
                  <div id="schedule-main-date-2" class="day-date"></div>
                </th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 5</div>
                  <div id="schedule-main-date-3" class="day-date"></div>
                </th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 6</div>
                  <div id="schedule-main-date-4" class="day-date"></div>
                </th>
                <th class="th-day">
                  <div class="day-name">Th·ª© 7</div>
                  <div id="schedule-main-date-5" class="day-date"></div>
                </th>
                <th class="th-day th-sunday">
                  <div class="day-name">Ch·ªß nh·∫≠t</div>
                  <div id="schedule-main-date-6" class="day-date"></div>
                </th>
              </tr>
            </thead>
            <tbody id="schedule-admin-body">
              <!-- JS render -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 4. ·∫®n h·∫≥n ph·∫ßn Chi ti·∫øt slot ƒëang ch·ªçn (DOM v·∫´n gi·ªØ cho JS) -->
      <section class="content-section" id="slot-editor-section" style="display:none;">
        <h2>Chi ti·∫øt slot ƒëang ch·ªçn</h2>
        <div id="slot-editor-empty" style="font-size:14px; color:#777;">
          Click v√†o m·ªôt √¥ trong b·∫£ng ƒë·ªÉ xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω r·∫£nh v√† ch·ªçn nh√¢n vi√™n cho slot ƒë√≥.
        </div>
        <div id="slot-editor" style="display:none;">
          <p id="slot-title" style="font-weight:600; margin-bottom:8px;"></p>
          <div id="slot-available-users" style="margin-bottom:8px;"></div>
          <button id="slot-save-btn" class="btn btn-primary">L∆∞u slot n√†y</button>
        </div>
      </section>
    </main>

    <!-- Mobile Quick Assignment FAB & Modal -->
    <div class="qa-modal-backdrop" id="qa-modal-backdrop"></div>
    <button class="qa-fab" id="qa-fab" style="display:none;">
      <span>‚ö°</span>
      <span class="qa-fab-badge" id="qa-fab-badge" style="display:none;">0</span>
    </button>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/schedule-admin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!Auth.requireAuth()) return;
      const currentUser = Auth.getCurrentUser();
      if (!currentUser || currentUser.role !== 'admin') {
        Auth.renderAuthUI();
        if (Auth._showAccessDenied) Auth._showAccessDenied();
        return;
      }
      Auth.renderAuthUI();
      if (window.ScheduleAdminPage && typeof ScheduleAdminPage.init === 'function') {
        ScheduleAdminPage.init();
      }
    });
  </script>
</body>
</html>
