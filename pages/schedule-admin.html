<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω l·ªãch l√†m - Crush Room Wiki</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üíé</span>
          <span class="logo-text">Crush Room</span>
        </div>
        <span class="wiki-badge">Wiki</span>
      </div>

      <nav class="sidebar-nav">
        <a href="../index.html" class="nav-item">
          <span class="nav-icon">üè†</span>
          <span>Trang ch·ªß</span>
        </a>

        <a href="schedule.html" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
        </a>

        <a href="schedule-admin.html" class="nav-item active" data-admin-only>
          <span class="nav-icon">üß©</span>
          <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
        </a>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üí¨</span>
            <span>Customer Service</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="cs/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="cs/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üì¢</span>
            <span>Marketing</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="marketing/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="marketing/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">‚ö°</span>
            <span>Laser</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="laser/guide.html" class="nav-subitem">H∆∞·ªõng d·∫´n kh·∫Øc Laser</a>
            <a href="laser/lightburn.html" class="nav-subitem">Th√¥ng s·ªë Lightburn</a>
          </div>
        </div>
      </nav>

      <div class="user-info"></div>

      <div class="sidebar-footer">
        <p>¬© 2025 Crush Room</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="breadcrumb">
        <a href="../index.html">Trang ch·ªß</a>
        <span>/</span>
        <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
      </div>

      <header class="page-header">
        <h1>üß© Qu·∫£n l√Ω l·ªãch l√†m (Leader)</h1>
        <p class="header-subtitle">
          Xem ƒëƒÉng k√Ω ca linh ho·∫°t, ph√¢n ca theo gi·ªù v√† ch·ªët l·ªãch l√†m ch√≠nh th·ª©c cho team.
        </p>
      </header>

      <!-- 1. Ch·ªçn tu·∫ßn & team + tr·∫°ng th√°i -->
      <section class="content-section">
        <h2>1. Ch·ªçn tu·∫ßn &amp; team</h2>
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:8px;">
          <div>
            <label for="week-start-admin">Tu·∫ßn b·∫Øt ƒë·∫ßu:</label><br />
            <input type="date" id="week-start-admin" />
          </div>
          <div>
            <label for="team-select-admin">Team:</label><br />
            <select id="team-select-admin">
              <option value="cs">Customer Service (CS)</option>
              <option value="mo">Marketing (MO)</option>
            </select>
          </div>
          <div style="margin-top:18px;">
            <button id="load-admin-btn" class="btn btn-secondary">T·∫£i d·ªØ li·ªáu</button>
          </div>
          <span id="admin-message" style="font-size:14px; margin-left:8px;"></span>
        </div>

        <!-- Thanh tr·∫°ng th√°i tu·∫ßn + n√∫t ch·ªët/m·ªü -->
        <div class="schedule-admin-status-bar"
             style="margin-top:4px; padding:8px 12px; border-radius:8px; background:#f5f5f5; display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
          <span id="week-status-text" style="font-size:14px; color:#555;">
            <!-- JS c·∫≠p nh·∫≠t: Tr·∫°ng th√°i: ƒêANG SO·∫†N / ƒê√É CH·ªêT -->
          </span>
          <button id="lock-week-btn"
                  class="btn btn-secondary"
                  style="margin-left:auto; font-size:13px; padding:6px 10px;">
            <!-- JS: "‚úÖ Ch·ªët l·ªãch tu·∫ßn n√†y" ho·∫∑c "üîì M·ªü l·∫°i ƒë·ªÉ ch·ªânh s·ª≠a" -->
          </button>
        </div>

        <p style="font-size:13px; color:#777; margin-top:8px;">
          M·ªói √¥ trong b·∫£ng th·ªÉ hi·ªán: <strong>ƒê√£ ph√¢n / S·ªë ng∆∞·ªùi ƒëƒÉng k√Ω</strong>.
          <br />
          ‚Ä¢ T√™n nh√¢n vi√™n s·∫Ω hi·ªÉn th·ªã tr·ª±c ti·∫øp trong √¥ (m·ªói ng∆∞·ªùi m·ªôt m√†u).  
          ‚Ä¢ <strong>Click v√†o t√™n</strong> ƒë·ªÉ b·∫≠t/t·∫Øt ph√¢n ca cho ng∆∞·ªùi ƒë√≥.  
          ‚Ä¢ <strong>Click v√†o c·∫£ √¥</strong> ƒë·ªÉ m·ªü panel chi ti·∫øt b√™n d∆∞·ªõi v√† ch·ªânh b·∫±ng checkbox.
        </p>
      </section>

      <!-- 2. B·∫£ng ca theo gi·ªù -->
      <section class="content-section">
        <h2>2. B·∫£ng ca theo gi·ªù</h2>
        <div style="overflow-x:auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Gi·ªù / Ng√†y</th>
                <th>Th·ª© 2</th>
                <th>Th·ª© 3</th>
                <th>Th·ª© 4</th>
                <th>Th·ª© 5</th>
                <th>Th·ª© 6</th>
                <th>Th·ª© 7</th>
                <th>Ch·ªß nh·∫≠t</th>
              </tr>
            </thead>
            <tbody id="schedule-admin-body">
              <!-- JS render -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 3. Chi ti·∫øt slot ƒëang ch·ªçn -->
      <section class="content-section" id="slot-editor-section">
        <h2>3. Chi ti·∫øt slot ƒëang ch·ªçn</h2>
        <div id="slot-editor-empty" style="font-size:14px; color:#777;">
          Click v√†o m·ªôt √¥ trong b·∫£ng ƒë·ªÉ xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω r·∫£nh v√† ch·ªçn nh√¢n vi√™n cho slot ƒë√≥.
        </div>
        <div id="slot-editor" style="display:none;">
          <p id="slot-title" style="font-weight:600; margin-bottom:8px;"></p>
          <div id="slot-available-users" style="margin-bottom:8px;"></div>
          <button id="slot-save-btn" class="btn btn-primary">L∆∞u slot n√†y</button>
        </div>
      </section>

      <!-- 4. L∆∞u l·ªãch tu·∫ßn n√†y -->
      <section class="content-section">
        <h2>4. L∆∞u l·ªãch tu·∫ßn n√†y</h2>
        <p style="font-size:13px; color:#777; margin-bottom:8px;">
          N√∫t n√†y s·∫Ω l∆∞u to√†n b·ªô ph√¢n ca hi·ªán t·∫°i xu·ªëng Google Sheet (sheet <strong>Schedule</strong>).
          ƒê·ªÉ nh√¢n vi√™n th·∫•y l·ªãch ch√≠nh th·ª©c, h√£y b·∫•m n√∫t <strong>"Ch·ªët l·ªãch tu·∫ßn n√†y"</strong> ·ªü thanh tr·∫°ng th√°i ph√≠a tr√™n.
        </p>
        <button id="save-week-schedule-btn" class="btn btn-primary">
          üíæ L∆∞u l·ªãch l√†m cho tu·∫ßn n√†y
        </button>
        <span id="save-week-message" style="margin-left:8px; font-size:14px;"></span>
      </section>

           <!-- 5. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt cho leader) -->
      <section class="content-section">
        <h2>5. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt)</h2>
        <p style="font-size:13px; color:#777; margin-bottom:8px;">
          Khi tr·∫°ng th√°i tu·∫ßn l√† <strong>ƒê√É CH·ªêT</strong>, ƒë√¢y l√† ph·∫ßn t·ªïng h·ª£p l·ªãch ch√≠nh th·ª©c theo ca v√† nh√¢n vi√™n,
          tr√¨nh b√†y gi·ªëng b·∫£ng ca theo gi·ªù ƒë·ªÉ leader d·ªÖ theo d√µi.
        </p>
        <div id="final-schedule-admin-status"
             style="font-size:14px; margin-bottom:8px; color:#555;">
          <!-- JS hi·ªÉn th·ªã: tr·∫°ng th√°i -->
        </div>

        <div id="final-schedule-admin-wrapper"
             style="overflow-x:auto; display:none;">
          <table class="data-table">
            <thead>
              <tr id="final-schedule-admin-head-row">
                <!-- JS render: Gi·ªù / Ng√†y + 7 c·ªôt th·ª© 2..CN -->
              </tr>
            </thead>
            <tbody id="final-schedule-admin-body">
              <!-- JS render grid t√≥m t·∫Øt -->
            </tbody>
          </table>
        </div>

        <div id="final-schedule-admin-empty"
             style="font-size:13px; color:#777; margin-top:8px; display:none;">
          Tu·∫ßn n√†y ch∆∞a c√≥ l·ªãch ch√≠nh th·ª©c n√†o ƒë∆∞·ª£c x·∫øp.
        </div>
      </section>

    </main>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/schedule-admin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!Auth.requireAuth()) return;
      const currentUser = Auth.getCurrentUser();
      // Ch·ªâ cho Admin d√πng trang n√†y
      if (!currentUser || currentUser.role !== 'admin') {
        Auth.renderAuthUI();
        if (Auth._showAccessDenied) Auth._showAccessDenied();
        return;
      }
      Auth.renderAuthUI();
      if (window.ScheduleAdminPage && typeof ScheduleAdminPage.init === 'function') {
        ScheduleAdminPage.init();
      }
    });
  </script>
</body>
</html>
