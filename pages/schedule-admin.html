<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω l·ªãch l√†m - Crush Room Wiki</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üíé</span>
          <span class="logo-text">Crush Room</span>
        </div>
        <span class="wiki-badge">Wiki</span>
      </div>

      <nav class="sidebar-nav">
        <a href="../index.html" class="nav-item">
          <span class="nav-icon">üè†</span>
          <span>Trang ch·ªß</span>
        </a>

        <a href="schedule.html" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
        </a>

        <a href="schedule-admin.html" class="nav-item active" data-admin-only>
          <span class="nav-icon">üß©</span>
          <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
        </a>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üí¨</span>
            <span>Customer Service</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="cs/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="cs/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üì¢</span>
            <span>Marketing</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="marketing/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="marketing/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">‚ö°</span>
            <span>Laser</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="laser/guide.html" class="nav-subitem">H∆∞·ªõng d·∫´n kh·∫Øc Laser</a>
            <a href="laser/lightburn.html" class="nav-subitem">Th√¥ng s·ªë Lightburn</a>
          </div>
        </div>
      </nav>

      <div class="user-info"></div>

      <div class="sidebar-footer">
        <p>¬© 2025 Crush Room</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="breadcrumb">
        <a href="../index.html">Trang ch·ªß</a>
        <span>/</span>
        <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
      </div>

      <header class="page-header">
        <h1>üß© Qu·∫£n l√Ω l·ªãch l√†m (Leader)</h1>
        <p class="header-subtitle">
          Xem ƒëƒÉng k√Ω ca linh ho·∫°t, ph√¢n ca theo gi·ªù v√† ch·ªët l·ªãch l√†m ch√≠nh th·ª©c cho team.
        </p>
      </header>

      <!-- 1. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt) ‚Äì ƒê∆ØA L√äN ƒê·∫¶U -->
      <section class="content-section">
        <h2>1. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt)</h2>
        <p style="font-size:13px; color:#777; margin-bottom:8px;">
          Khi tr·∫°ng th√°i tu·∫ßn l√† <strong>ƒê√É CH·ªêT</strong>, ƒë√¢y l√† ph·∫ßn t·ªïng h·ª£p l·ªãch ch√≠nh th·ª©c
          theo ca v√† nh√¢n vi√™n, tr√¨nh b√†y gi·ªëng b·∫£ng ca theo gi·ªù ƒë·ªÉ leader d·ªÖ theo d√µi.
        </p>
        <div id="final-schedule-admin-status" style="font-size:14px; margin-bottom:8px; color:#555;">
          <!-- JS hi·ªÉn th·ªã: tr·∫°ng th√°i l·ªãch ch·ªët -->
        </div>
        <div id="final-schedule-admin-wrapper" style="overflow-x:auto; display:none;">
          <table class="data-table">
            <thead>
              <tr id="final-schedule-admin-head-row">
                <!-- JS render header: Gi·ªù / Ng√†y + c√°c ng√†y trong tu·∫ßn -->
              </tr>
            </thead>
            <tbody id="final-schedule-admin-body">
              <!-- JS render t√≥m t·∫Øt l·ªãch ch·ªët d·∫°ng b·∫£ng gi·ªù x ng√†y -->
            </tbody>
          </table>
        </div>
        <div id="final-schedule-admin-empty" style="font-size:13px; color:#777; margin-top:8px; display:none;">
          Tu·∫ßn n√†y ch∆∞a c√≥ l·ªãch ch√≠nh th·ª©c n√†o ƒë∆∞·ª£c x·∫øp.
        </div>
      </section>

      <!-- 2. Ch·ªçn tu·∫ßn & team + tr·∫°ng th√°i -->
      <section class="content-section">
        <h2>2. Ch·ªçn tu·∫ßn &amp; team</h2>
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:8px;">
          <div>
            <label for="week-start-admin">Tu·∫ßn b·∫Øt ƒë·∫ßu:</label><br />
            <input type="date" id="week-start-admin" />
          </div>
          <div>
            <label for="team-select-admin">Team:</label><br />
            <select id="team-select-admin">
              <option value="cs">Customer Service (CS)</option>
              <option value="mo">Marketing (MO)</option>
            </select>
          </div>
          <div style="margin-top:18px;">
            <button id="load-admin-btn" class="btn btn-secondary">T·∫£i d·ªØ li·ªáu</button>
          </div>
          <span id="admin-message" style="font-size:14px; margin-left:8px;"></span>
        </div>

        <!-- Thanh tr·∫°ng th√°i tu·∫ßn + n√∫t L∆∞u + n√∫t Ch·ªët -->
        <div class="schedule-admin-status-bar"
             style="margin-top:4px; padding:8px 12px; border-radius:8px; background:#f5f5f5; display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
          <span id="week-status-text" style="font-size:14px; color:#555;">
            <!-- JS c·∫≠p nh·∫≠t: Tr·∫°ng th√°i: ƒêANG SO·∫†N / ƒê√É CH·ªêT -->
          </span>

          <span id="save-week-message" style="font-size:13px; margin-left:12px;">
            <!-- JS hi·ªÉn th·ªã message l∆∞u l·ªãch -->
          </span>

          <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
            <button id="save-week-schedule-btn"
                    class="btn btn-primary"
                    style="font-size:13px; padding:6px 10px;">
              üíæ L∆∞u l·ªãch tu·∫ßn n√†y
            </button>

            <button id="lock-week-btn"
                    class="btn btn-secondary"
                    style="font-size:13px; padding:6px 10px;">
              <!-- JS: "‚úÖ Ch·ªët l·ªãch tu·∫ßn n√†y" ho·∫∑c "üîì M·ªü l·∫°i ƒë·ªÉ ch·ªânh s·ª≠a" -->
            </button>
          </div>
        </div>

        <p style="font-size:13px; color:#777; margin-top:8px;">
          H√£y lu√¥n <strong>L∆∞u l·ªãch tu·∫ßn n√†y</strong> sau khi ph√¢n ca, sau ƒë√≥ d√πng n√∫t
          <strong>"Ch·ªët l·ªãch tu·∫ßn n√†y"</strong> ƒë·ªÉ kh√≥a v√† c√¥ng b·ªë cho nh√¢n vi√™n.
        </p>
      </section>

      <!-- 3. Quick Assignment Panel -->
      <section class="content-section">
        <h2>3. Quick Assignment Panel</h2>
        <p style="font-size:13px; color:#777; margin-bottom:12px;">
          Ch·ªçn nh√¢n vi√™n, sau ƒë√≥ click v√†o c√°c √¥ c·∫ßn ph√¢n ca trong b·∫£ng b√™n d∆∞·ªõi, cu·ªëi c√πng b·∫•m "Assign" ƒë·ªÉ ph√¢n ca nhanh.
        </p>

        <!-- Quick Assignment Panel (Horizontal Layout) -->
        <div id="quick-assignment-panel" style="background:#ffffff; border-radius:12px; padding:20px; border:1px solid #e8e8e8; margin-bottom:20px;">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:16px;">
            <span style="font-size:24px;">‚ö°</span>
            <h3 style="margin:0; font-size:16px; font-weight:700; color:#1a1a1a;">Quick Assignment</h3>
          </div>

          <div id="qa-mode-info" style="font-size:12px; color:#666; margin-bottom:16px; padding:10px 12px; background:linear-gradient(135deg, #fff3cd 0%, #ffe9a8 100%); border-radius:6px; border-left:3px solid #ffc107; line-height:1.6;">
            <strong style="color:#856404; display:block; margin-bottom:4px;">üìù C√°ch d√πng:</strong>
            <div style="color:#856404;">
              1Ô∏è‚É£ Ch·ªçn nh√¢n vi√™n<br />
              2Ô∏è‚É£ Click c√°c √¥ c·∫ßn ph√¢n ca trong b·∫£ng b√™n d∆∞·ªõi<br />
              3Ô∏è‚É£ Click "Assign"
            </div>
          </div>

          <!-- Horizontal Controls Layout -->
          <div style="display:grid; grid-template-columns: 1fr 1fr auto auto; gap:12px; align-items:end;">
            <!-- Selected Employee -->
            <div>
              <label style="font-size:13px; font-weight:600; display:block; margin-bottom:8px; color:#333;">
                üë§ Ch·ªçn nh√¢n vi√™n:
              </label>
              <select id="qa-employee-select" style="width:100%; padding:8px 10px; border-radius:6px; border:1px solid #ddd; font-size:13px; background:white;">
                <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
              </select>
            </div>

            <!-- Selected Cells Count -->
            <div id="qa-selected-count" style="font-size:13px; color:#333; padding:10px 12px; background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius:6px; border:1px solid #bae6fd; display:flex; align-items:center; justify-content:space-between;">
              <strong style="color:#0369a1;">üìä ƒê√£ ch·ªçn:</strong>
              <span id="qa-count-value" style="background:#0ea5e9; color:white; padding:2px 10px; border-radius:12px; font-size:13px; font-weight:700;">0</span>
            </div>

            <!-- Action Buttons -->
            <button id="qa-assign-btn" class="btn btn-primary" style="font-size:13px; padding:10px 20px; border-radius:6px; font-weight:600; white-space:nowrap;" disabled>
              ‚úÖ Assign to Selected
            </button>
            <button id="qa-clear-selection-btn" class="btn btn-secondary" style="font-size:13px; padding:10px 20px; border-radius:6px; font-weight:600; white-space:nowrap;">
              üîÑ Clear Selection
            </button>
          </div>

          <!-- Employee List (for reference) -->
          <div style="padding-top:16px; margin-top:16px; border-top:2px solid #f0f0f0;">
            <h4 style="font-size:13px; font-weight:600; margin:0 0 10px; color:#333; display:flex; align-items:center; gap:6px;">
              <span>üë•</span>
              <span>Nh√¢n vi√™n c√≥ s·∫µn</span>
            </h4>
            <div id="qa-employee-list" style="font-size:12px; color:#666; max-height:150px; overflow-y:auto; padding:4px;">
              <!-- JS renders employee list -->
            </div>
          </div>
        </div>
      </section>

      <!-- 4. B·∫£ng ca theo gi·ªù -->
      <section class="content-section">
        <h2>4. B·∫£ng ca theo gi·ªù</h2>
        <p style="font-size:13px; color:#777; margin-bottom:12px;">
          M·ªói √¥ trong b·∫£ng th·ªÉ hi·ªán: <strong>ƒê√£ ph√¢n / S·ªë ng∆∞·ªùi ƒëƒÉng k√Ω</strong>.<br />
          ‚Ä¢ T√™n nh√¢n vi√™n s·∫Ω hi·ªÉn th·ªã tr·ª±c ti·∫øp trong √¥ (m·ªói ng∆∞·ªùi m·ªôt m√†u).<br />
          ‚Ä¢ <strong>Click v√†o t√™n</strong> ƒë·ªÉ b·∫≠t/t·∫Øt ph√¢n ca cho ng∆∞·ªùi ƒë√≥.
          ‚Ä¢ Ho·∫∑c d√πng <strong>Quick Assignment Panel</strong> b√™n tr√™n ƒë·ªÉ ph√¢n ca nhanh cho nhi·ªÅu slot c√πng l√∫c.
        </p>

        <!-- Main Schedule Grid (Full Width) -->
        <div style="overflow-x:auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Gi·ªù / Ng√†y</th>
              <th>
                Th·ª© 2
                <div id="schedule-main-date-0"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 3
                <div id="schedule-main-date-1"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 4
                <div id="schedule-main-date-2"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 5
                <div id="schedule-main-date-3"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 6
                <div id="schedule-main-date-4"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 7
                <div id="schedule-main-date-5"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Ch·ªß nh·∫≠t
                <div id="schedule-main-date-6"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
            </tr>
          </thead>
          <tbody id="schedule-admin-body">
            <!-- JS render -->
          </tbody>
        </table>
      </div>
      </section>

      <!-- 5. ·∫®n h·∫≥n ph·∫ßn Chi ti·∫øt slot ƒëang ch·ªçn (DOM v·∫´n gi·ªØ cho JS) -->
      <section class="content-section" id="slot-editor-section" style="display:none;">
        <h2>Chi ti·∫øt slot ƒëang ch·ªçn</h2>
        <div id="slot-editor-empty" style="font-size:14px; color:#777;">
          Click v√†o m·ªôt √¥ trong b·∫£ng ƒë·ªÉ xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω r·∫£nh v√† ch·ªçn nh√¢n vi√™n cho slot ƒë√≥.
        </div>
        <div id="slot-editor" style="display:none;">
          <p id="slot-title" style="font-weight:600; margin-bottom:8px;"></p>
          <div id="slot-available-users" style="margin-bottom:8px;"></div>
          <button id="slot-save-btn" class="btn btn-primary">L∆∞u slot n√†y</button>
        </div>
      </section>
    </main>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/schedule-admin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!Auth.requireAuth()) return;
      const currentUser = Auth.getCurrentUser();
      if (!currentUser || currentUser.role !== 'admin') {
        Auth.renderAuthUI();
        if (Auth._showAccessDenied) Auth._showAccessDenied();
        return;
      }
      Auth.renderAuthUI();
      if (window.ScheduleAdminPage && typeof ScheduleAdminPage.init === 'function') {
        ScheduleAdminPage.init();
      }
    });
  </script>
</body>
</html>
