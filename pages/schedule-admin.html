<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω l·ªãch l√†m - Crush Room Wiki</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üíé</span>
          <span class="logo-text">Crush Room</span>
        </div>
        <span class="wiki-badge">Wiki</span>
      </div>

      <nav class="sidebar-nav">
        <a href="../index.html" class="nav-item">
          <span class="nav-icon">üè†</span>
          <span>Trang ch·ªß</span>
        </a>

        <a href="schedule.html" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
        </a>

        <a href="schedule-admin.html" class="nav-item active" data-admin-only>
          <span class="nav-icon">üß©</span>
          <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
        </a>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üí¨</span>
            <span>Customer Service</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="cs/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="cs/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">üì¢</span>
            <span>Marketing</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="marketing/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
            <a href="marketing/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-header">
            <span class="nav-icon">‚ö°</span>
            <span>Laser</span>
            <span class="nav-arrow">‚ñº</span>
          </div>
          <div class="nav-group-items">
            <a href="laser/guide.html" class="nav-subitem">H∆∞·ªõng d·∫´n kh·∫Øc Laser</a>
            <a href="laser/lightburn.html" class="nav-subitem">Th√¥ng s·ªë Lightburn</a>
          </div>
        </div>
      </nav>

      <div class="user-info"></div>

      <div class="sidebar-footer">
        <p>¬© 2025 Crush Room</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="breadcrumb">
        <a href="../index.html">Trang ch·ªß</a>
        <span>/</span>
        <span>Qu·∫£n l√Ω l·ªãch l√†m</span>
      </div>

      <header class="page-header">
        <h1>üß© Qu·∫£n l√Ω l·ªãch l√†m (Leader)</h1>
        <p class="header-subtitle">
          Xem ƒëƒÉng k√Ω ca linh ho·∫°t, ph√¢n ca theo gi·ªù v√† ch·ªët l·ªãch l√†m ch√≠nh th·ª©c cho team.
        </p>
      </header>

      <!-- 1. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt) ‚Äì ƒê∆ØA L√äN ƒê·∫¶U -->
      <section class="content-section">
        <h2>1. L·ªãch l√†m ƒë√£ ch·ªët tu·∫ßn n√†y (t√≥m t·∫Øt)</h2>
        <p style="font-size:13px; color:#777; margin-bottom:8px;">
          Khi tr·∫°ng th√°i tu·∫ßn l√† <strong>ƒê√É CH·ªêT</strong>, ƒë√¢y l√† ph·∫ßn t·ªïng h·ª£p l·ªãch ch√≠nh th·ª©c
          theo ca v√† nh√¢n vi√™n, tr√¨nh b√†y gi·ªëng b·∫£ng ca theo gi·ªù ƒë·ªÉ leader d·ªÖ theo d√µi.
        </p>
        <div id="final-schedule-admin-status" style="font-size:14px; margin-bottom:8px; color:#555;">
          <!-- JS hi·ªÉn th·ªã: tr·∫°ng th√°i l·ªãch ch·ªët -->
        </div>
        <div id="final-schedule-admin-wrapper" style="overflow-x:auto; display:none;">
          <table class="data-table">
            <thead>
              <tr id="final-schedule-admin-head-row">
                <!-- JS render header: Gi·ªù / Ng√†y + c√°c ng√†y trong tu·∫ßn -->
              </tr>
            </thead>
            <tbody id="final-schedule-admin-body">
              <!-- JS render t√≥m t·∫Øt l·ªãch ch·ªët d·∫°ng b·∫£ng gi·ªù x ng√†y -->
            </tbody>
          </table>
        </div>
        <div id="final-schedule-admin-empty" style="font-size:13px; color:#777; margin-top:8px; display:none;">
          Tu·∫ßn n√†y ch∆∞a c√≥ l·ªãch ch√≠nh th·ª©c n√†o ƒë∆∞·ª£c x·∫øp.
        </div>
      </section>

      <!-- 2. Ch·ªçn tu·∫ßn & team + tr·∫°ng th√°i -->
      <section class="content-section">
        <h2>2. Ch·ªçn tu·∫ßn &amp; team</h2>
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:8px;">
          <div>
            <label for="week-start-admin">Tu·∫ßn b·∫Øt ƒë·∫ßu:</label><br />
            <input type="date" id="week-start-admin" />
          </div>
          <div>
            <label for="team-select-admin">Team:</label><br />
            <select id="team-select-admin">
              <option value="cs">Customer Service (CS)</option>
              <option value="mo">Marketing (MO)</option>
            </select>
          </div>
          <div style="margin-top:18px;">
            <button id="load-admin-btn" class="btn btn-secondary">T·∫£i d·ªØ li·ªáu</button>
          </div>
          <span id="admin-message" style="font-size:14px; margin-left:8px;"></span>
        </div>

        <!-- Thanh tr·∫°ng th√°i tu·∫ßn + n√∫t L∆∞u + n√∫t Ch·ªët -->
        <div class="schedule-admin-status-bar"
             style="margin-top:4px; padding:8px 12px; border-radius:8px; background:#f5f5f5; display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
          <span id="week-status-text" style="font-size:14px; color:#555;">
            <!-- JS c·∫≠p nh·∫≠t: Tr·∫°ng th√°i: ƒêANG SO·∫†N / ƒê√É CH·ªêT -->
          </span>

          <span id="save-week-message" style="font-size:13px; margin-left:12px;">
            <!-- JS hi·ªÉn th·ªã message l∆∞u l·ªãch -->
          </span>

          <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
            <button id="save-week-schedule-btn"
                    class="btn btn-primary"
                    style="font-size:13px; padding:6px 10px;">
              üíæ L∆∞u l·ªãch tu·∫ßn n√†y
            </button>

            <button id="lock-week-btn"
                    class="btn btn-secondary"
                    style="font-size:13px; padding:6px 10px;">
              <!-- JS: "‚úÖ Ch·ªët l·ªãch tu·∫ßn n√†y" ho·∫∑c "üîì M·ªü l·∫°i ƒë·ªÉ ch·ªânh s·ª≠a" -->
            </button>
          </div>
        </div>

        <p style="font-size:13px; color:#777; margin-top:8px;">
          H√£y lu√¥n <strong>L∆∞u l·ªãch tu·∫ßn n√†y</strong> sau khi ph√¢n ca, sau ƒë√≥ d√πng n√∫t
          <strong>"Ch·ªët l·ªãch tu·∫ßn n√†y"</strong> ƒë·ªÉ kh√≥a v√† c√¥ng b·ªë cho nh√¢n vi√™n.
        </p>
      </section>

      <!-- 3. B·∫£ng ca theo gi·ªù + Quick Assignment Panel -->
      <section class="content-section">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
          <div>
            <h2 style="margin:0 0 8px 0;">3. B·∫£ng ca theo gi·ªù</h2>
            <p style="font-size:13px; color:#777; margin:0;">
              ‚Ä¢ <strong>Overview mode</strong>: T√™n ng·∫Øn g·ªçn, size nh·ªè, m√†u t∆∞∆°ng ph·∫£n cao.<br />
              ‚Ä¢ <strong>Detail mode</strong>: T√™n ƒë·∫ßy ƒë·ªß c·ªßa t·ª´ng nh√¢n vi√™n.<br />
              ‚Ä¢ <strong>Click v√†o badge</strong> ƒë·ªÉ b·∫≠t/t·∫Øt ph√¢n ca. Ho·∫∑c d√πng <strong>Quick Assignment</strong> b√™n d∆∞·ªõi.
            </p>
          </div>

          <!-- View Mode Toggle -->
          <div id="view-mode-toggle" style="display:flex; gap:6px; background:#f8f9fa; padding:4px; border-radius:8px; border:1px solid #e0e0e0;">
            <button id="toggle-overview-mode" class="view-toggle-btn active" style="padding:8px 16px; border:none; background:#ffffff; border-radius:6px; cursor:pointer; font-size:13px; font-weight:600; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
              üìä Overview
            </button>
            <button id="toggle-detail-mode" class="view-toggle-btn" style="padding:8px 16px; border:none; background:transparent; border-radius:6px; cursor:pointer; font-size:13px; font-weight:600; transition:all 0.2s; color:#666;">
              üìã Detail
            </button>
          </div>
        </div>

        <!-- Quick Assignment Panel (Compact Horizontal Layout) -->
        <div id="quick-assignment-panel" style="background:#f8f9fa; border-radius:8px; padding:16px; margin-bottom:16px; border:1px solid #e0e0e0;">
          <div style="display:grid; grid-template-columns: auto 1fr auto auto auto; gap:12px; align-items:center;">
            <!-- Title -->
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="font-size:18px;">‚ö°</span>
              <strong style="font-size:14px; color:#1a1a1a; white-space:nowrap;">Quick Assignment</strong>
            </div>

            <!-- Employee Select -->
            <select id="qa-employee-select" style="padding:8px 12px; border-radius:6px; border:1px solid #ccc; font-size:13px; background:white; min-width:200px;">
              <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
            </select>

            <!-- Selected Count -->
            <div id="qa-selected-count" style="display:flex; align-items:center; gap:8px; padding:6px 12px; background:white; border-radius:6px; border:1px solid #bae6fd; white-space:nowrap;">
              <strong style="font-size:12px; color:#0369a1;">ƒê√£ ch·ªçn:</strong>
              <span id="qa-count-value" style="background:#0ea5e9; color:white; padding:2px 8px; border-radius:12px; font-size:12px; font-weight:700; min-width:20px; text-align:center;">0</span>
            </div>

            <!-- Assign Button -->
            <button id="qa-assign-btn" class="btn btn-primary" style="padding:8px 16px; border-radius:6px; font-size:13px; font-weight:600; white-space:nowrap;" disabled>
              ‚úÖ Assign
            </button>

            <!-- Clear Button -->
            <button id="qa-clear-selection-btn" class="btn btn-secondary" style="padding:8px 16px; border-radius:6px; font-size:13px; font-weight:600; white-space:nowrap;">
              üîÑ Clear
            </button>
          </div>
        </div>

        <!-- Main Schedule Grid (Full Width) -->
        <div style="overflow-x:auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Gi·ªù / Ng√†y</th>
              <th>
                Th·ª© 2
                <div id="schedule-main-date-0"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 3
                <div id="schedule-main-date-1"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 4
                <div id="schedule-main-date-2"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 5
                <div id="schedule-main-date-3"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 6
                <div id="schedule-main-date-4"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Th·ª© 7
                <div id="schedule-main-date-5"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
              <th>
                Ch·ªß nh·∫≠t
                <div id="schedule-main-date-6"
                     style="font-size:12px; color:#777; margin-top:2px;"></div>
              </th>
            </tr>
          </thead>
          <tbody id="schedule-admin-body">
            <!-- JS render -->
          </tbody>
        </table>
      </div>
      </section>

      <!-- 4. ·∫®n h·∫≥n ph·∫ßn Chi ti·∫øt slot ƒëang ch·ªçn (DOM v·∫´n gi·ªØ cho JS) -->
      <section class="content-section" id="slot-editor-section" style="display:none;">
        <h2>Chi ti·∫øt slot ƒëang ch·ªçn</h2>
        <div id="slot-editor-empty" style="font-size:14px; color:#777;">
          Click v√†o m·ªôt √¥ trong b·∫£ng ƒë·ªÉ xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω r·∫£nh v√† ch·ªçn nh√¢n vi√™n cho slot ƒë√≥.
        </div>
        <div id="slot-editor" style="display:none;">
          <p id="slot-title" style="font-weight:600; margin-bottom:8px;"></p>
          <div id="slot-available-users" style="margin-bottom:8px;"></div>
          <button id="slot-save-btn" class="btn btn-primary">L∆∞u slot n√†y</button>
        </div>
      </section>
    </main>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/schedule-admin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!Auth.requireAuth()) return;
      const currentUser = Auth.getCurrentUser();
      if (!currentUser || currentUser.role !== 'admin') {
        Auth.renderAuthUI();
        if (Auth._showAccessDenied) Auth._showAccessDenied();
        return;
      }
      Auth.renderAuthUI();
      if (window.ScheduleAdminPage && typeof ScheduleAdminPage.init === 'function') {
        ScheduleAdminPage.init();
      }
    });
  </script>
</body>
</html>
