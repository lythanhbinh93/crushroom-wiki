<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng k√Ω l·ªãch l√†m - Crush Room Wiki</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üíé</span>
                    <span class="logo-text">Crush Room</span>
                </div>
                <span class="wiki-badge">Wiki</span>
            </div>
            
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item">
                    <span class="nav-icon">üè†</span>
                    <span>Trang ch·ªß</span>
                </a>
                
                <!-- TH√äM class nav-schedule-link ƒë·ªÉ c√≤n ·∫©n b·∫±ng JS -->
                <a href="schedule.html" class="nav-item active nav-schedule-link">
                    <span class="nav-icon">üìÖ</span>
                    <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
                </a>
                
                <div class="nav-group">
                    <div class="nav-group-header">
                        <span class="nav-icon">üí¨</span>
                        <span>Customer Service</span>
                        <span class="nav-arrow">‚ñº</span>
                    </div>
                    <div class="nav-group-items">
                        <a href="cs/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
                        <a href="cs/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
                    </div>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-header">
                        <span class="nav-icon">üì¢</span>
                        <span>Marketing</span>
                        <span class="nav-arrow">‚ñº</span>
                    </div>
                    <div class="nav-group-items">
                        <a href="marketing/library.html" class="nav-subitem">Th∆∞ vi·ªán h·ªçc t·∫≠p</a>
                        <a href="marketing/quiz.html" class="nav-subitem">B√†i ki·ªÉm tra</a>
                    </div>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-header">
                        <span class="nav-icon">‚ö°</span>
                        <span>Laser</span>
                        <span class="nav-arrow">‚ñº</span>
                    </div>
                    <div class="nav-group-items">
                        <a href="laser/guide.html" class="nav-subitem">H∆∞·ªõng d·∫´n kh·∫Øc Laser</a>
                        <a href="laser/lightburn.html" class="nav-subitem">Th√¥ng s·ªë Lightburn</a>
                    </div>
                </div>
            </nav>
            
            <!-- User Info -->
            <div class="user-info"></div>
            
            <div class="sidebar-footer">
                <p>¬© 2025 Crush Room</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="breadcrumb">
                <a href="../index.html">Trang ch·ªß</a>
                <span>/</span>
                <span>ƒêƒÉng k√Ω l·ªãch l√†m</span>
            </div>
            
            <header class="page-header">
                <div class="page-header-content">
                    <h1>üìÖ ƒêƒÉng k√Ω l·ªãch l√†m</h1>
                    <p class="header-subtitle">Ch·ªçn tu·∫ßn v√† tick nh·ªØng ca b·∫°n c√≥ th·ªÉ l√†m. Leader s·∫Ω ph√¢n ca d·ª±a tr√™n ƒëƒÉng k√Ω n√†y.</p>
                </div>
            </header>

            <!-- ƒêƒÉng k√Ω l·ªãch r·∫£nh -->
            <section id="availability-section" class="content-section schedule-card">
                <div class="section-header">
                    <div class="section-title-group">
                        <h2>üìä ƒêƒÉng k√Ω ca l√†m vi·ªác</h2>
                    </div>

                    <!-- View Mode Toggle -->
                    <div class="view-mode-toggle">
                        <button id="toggle-register-mode" class="view-toggle-btn active">
                            <span class="btn-icon">üìù</span>
                            ƒêƒÉng k√Ω l·ªãch r√£nh
                        </button>
                        <button id="toggle-view-mode" class="view-toggle-btn">
                            <span class="btn-icon">üë•</span>
                            Xem l·ªãch ch·ªët
                        </button>
                    </div>
                </div>

                <!-- Register Mode Content -->
                <div id="register-mode-content">
                    <div class="filter-controls">
                    <div class="form-group">
                        <label for="week-start-input" class="form-label">Tu·∫ßn b·∫Øt ƒë·∫ßu</label>
                        <input type="date" id="week-start-input" class="form-input" />
                    </div>
                    <div class="form-group">
                        <button id="load-week-btn" class="btn btn-primary">
                            <span class="btn-icon">üì•</span>
                            T·∫£i ƒëƒÉng k√Ω
                        </button>
                    </div>
                </div>

                <div id="schedule-message" class="alert-message"></div>

                <div class="table-wrapper">
                    <table class="data-table schedule-table">
                        <thead>
                            <tr>
                                <th>Ca / Ng√†y</th>
                                <th>Th·ª© 2</th>
                                <th>Th·ª© 3</th>
                                <th>Th·ª© 4</th>
                                <th>Th·ª© 5</th>
                                <th>Th·ª© 6</th>
                                <th>Th·ª© 7</th>
                                <th>Ch·ªß nh·∫≠t</th>
                            </tr>
                        </thead>
                        <tbody id="availability-body">
                            <!-- JS render -->
                        </tbody>
                    </table>
                </div>

                <div class="schedule-actions" style="margin-top:20px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                    <button id="save-availability-btn" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        L∆∞u l·ªãch r·∫£nh
                    </button>
                </div>

                    <div class="info-box" style="margin-top:16px;">
                        <span class="info-icon">üí°</span>
                        <p>Nh·ªõ <strong>L∆∞u l·ªãch r·∫£nh</strong> sau khi ch·ªçn ca ‚Üí Leader s·∫Ω ph√¢n ca d·ª±a tr√™n ƒëƒÉng k√Ω</p>
                    </div>
                </div>

                <!-- View Mode Content -->
                <div id="view-mode-content" style="display:none;">
                    <div class="filter-controls">
                        <div class="form-group">
                            <label for="view-week-start-input" class="form-label">Tu·∫ßn b·∫Øt ƒë·∫ßu</label>
                            <input type="date" id="view-week-start-input" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label for="view-team-select" class="form-label">Team</label>
                            <select id="view-team-select" class="form-select">
                                <option value="cs" selected>Customer Service (CS)</option>
                                <option value="mo">Marketing (MO)</option>
                                <option value="all">T·∫•t c·∫£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button id="load-team-schedule-btn" class="btn btn-primary">
                                <span class="btn-icon">üì•</span>
                                T·∫£i l·ªãch
                            </button>
                        </div>
                    </div>

                    <div id="view-schedule-message" class="alert-message"></div>

                    <div id="team-schedule-status" class="status-badge-container"></div>

                    <div id="team-schedule-wrapper" class="table-wrapper" style="display:none;">
                        <table class="data-table schedule-table">
                            <thead>
                                <tr id="team-schedule-head-row">
                                    <!-- JS render header -->
                                </tr>
                            </thead>
                            <tbody id="team-schedule-body">
                                <!-- JS render body -->
                            </tbody>
                        </table>
                    </div>

                    <div id="team-schedule-empty" class="empty-state" style="display:none;">
                        <span class="empty-icon">üì≠</span>
                        <p>Ch∆∞a c√≥ l·ªãch ch√≠nh th·ª©c n√†o ƒë∆∞·ª£c ch·ªët</p>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script src="../js/auth.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/schedule.js"></script>
    <script>
        // ·∫®n menu "ƒêƒÉng k√Ω l·ªãch l√†m" cho nh√¢n vi√™n fulltime kh√¥ng thu·ªôc team CS
        function hideScheduleNavForFulltimeNonCS() {
            const user = Auth.getCurrentUser();
            if (!user) return;

            const employmentType = (user.employmentType || 'parttime').toLowerCase();
            const isFulltime = employmentType === 'fulltime';
            const isCS = user.permissions && user.permissions.cs;

            // Fulltime v√† KH√îNG c√≥ quy·ªÅn CS -> ·∫©n menu
            if (isFulltime && !isCS) {
                const links = document.querySelectorAll('.nav-schedule-link');
                links.forEach(link => {
                    link.style.display = 'none';
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (!Auth.requireAuth()) return;
            Auth.renderAuthUI();

            // G·ªçi h√†m ·∫©n menu cho fulltime kh√¥ng thu·ªôc team CS
            hideScheduleNavForFulltimeNonCS();

            if (window.SchedulePage && typeof SchedulePage.init === 'function') {
                SchedulePage.init();
            }
        });
    </script>
</body>
</html>
